# Найденные баги в API микросервиса объявлений

### БАГ 1: Отсутствует валидация отрицательных числовых значений

**Эндпоинт:** POST /api/1/item

**Описание:** API не проверяет отрицательные значения в обязательных полях

**Упавшие тесты:**
- test_create_ad_negative_price
- test_create_ad_negative_likes  
- test_create_ad_negative_viewCount
- test_create_ad_negative_contacts
- test_create_ad_negative_sellerid
- test_create_ad_multiple_negative_values


**Проблемные поля:**
- `price` - цена товара
- `statistics.likes` - количество лайков
- `statistics.viewCount` - количество просмотров  
- `statistics.contacts` - количество контактов
- `sellerID` - айди продавца

**Пример запроса:**
```json
{
  "sellerID": -123456,
  "name": "Test Product",
  "price": -100,
  "statistics": {
    "likes": -10,
    "viewCount": -100,
    "contacts": -5
  }
}
```

Ожидаемый результат: Ответ 400 при любом отрицательном значении

Фактический результат: Ответ 200

### БАГ 2: Уязвимости XSS (Межсайтовый скриптинг)
**Приоритет:** Критический  
**Эндпоинт:** POST /api/1/item

**Описание:** API не выполняет санитизацию входных данных от XSS-атак, что позволяет внедрять вредоносные скрипты

**Упавшие тесты:**
- `test_create_ad_invalid_name_values[<script>alert('XSS')</script>]`
- `test_create_ad_invalid_name_values[<img src=x onerror=alert(1)>]`

**Проблема:**
- Не экранируются теги `<script>`
- Не удаляются опасные атрибуты `onerror`
- HTML-теги принимаются без санитизации

**Шаги воспроизведения:**
1. Отправить запрос с полем `name`, содержащим XSS-пейлоад:
```json
{
  "sellerID": 123456,
  "name": "<script>alert('XSS')</script>",
  "price": 100
}
```
Ожидаемый результат: Теги и скрипты должны экранироваться или запрос должен отклоняться с ошибкой 400

Фактический результат: Объявление создается с опасным контентом

---

### БАГ 3: Отсутствует валидация длины поля name
**Приоритет:** Высокий
**Эндпоинт:** POST /api/1/item

**Описание:** API принимает имена длиной более 256 символов без ограничений

**Упавшие тесты:**

- test_create_ad_name_length_boundaries

**Проблема:**

Нет ограничения максимальной длины для поля name

Принимаются строки длиной 256+ символов

Шаги воспроизведения:

Создать объявление с именем длиной 257 символов:

```json
{
  "sellerID": 123456,
  "name": "A" * 257,
  "price": 100
}
```
Ожидаемый результат: Ошибка 400 при превышении лимита длины

Фактический результат: Объявление успешно создается

---

### БАГ 4: Неправильная валидация числовых границ sellerID
**Приоритет:** Высокий
**Эндпоинт:** POST /api/1/item

**Описание:** API некорректно обрабатывает большие значения sellerID и выдает misleading error messages

**Упавшие тесты:**

- test_create_ad_very_large_seller_id[999999999999999999_0]
- test_create_ad_very_large_seller_id[2147483648]
- test_create_ad_very_large_seller_id[9223372036854775808]
- test_create_ad_very_large_seller_id[999999999999999999_1]
- test_create_ad_numeric_boundaries_seller_id

**Проблемы:**

Принимаются значения sellerID превышающие MAX_INT32

Нет четкой валидации числового диапазона

В ответе иногда отсутствует поле 'sellerID'

Некорректные сообщения об ошибках для больших значений

**Шаги воспроизведения:**

```json
{
  "sellerID": 2147483648,
  "name": "Product with large sellerID",
  "price": 100
}
```
Ожидаемый результат: Четкая ошибка валидации с указанием допустимого диапазона

Фактический результат: Непредсказуемое поведение - то принимается, то ошибка с misleading message

---

### БАГ 5: Невалидация специальных символов в имени
**Приоритет:** Средний
**Эндпоинт:** POST /api/1/item

**Описание:** Принимаются имена с HTML-тегами без санитизации

**Упавшие тесты:**

- test_create_ad_special_characters_in_name

**Шаги воспроизведения:**

```json
{
  "sellerID": 123456,
  "name": "Product with <html> tags",
  "price": 100
}
```
Ожидаемый результат: HTML-теги должны экранироваться или запрос отклоняться

Фактический результат: Объявление создается с HTML-тегами в имени

**Рекомендации по исправлению**

1. Внедрить санитизацию входных данных - экранировать HTML-теги и опасные символы

2. Добавить строгую валидацию длины - ограничить поле name 255 символами

3. Определить четкие числовые границы для sellerID и других числовых полей

4. Запретить отрицательные значения для всех числовых полей

5. Улучшить сообщения об ошибках - сделать их информативными и понятными

```text

Этот файл теперь содержит все выявленные баги из проваленных тестов с четким описанием, шагами воспроизведения и рекомендациями по исправлению.
```

---

### БАГ 6: Некорректная валидация нулевой цены
**Приоритет:** Средний  
**Эндпоинт:** POST /api/1/item

**Описание:** API некорректно обрабатывает значение цены (price) равное 0, что мешает создавать объявления с бесплатными товарами

**Упавшие тесты:**
- `test_create_ad_zero_values` (для поля "price")

**Проблема:**
- Значение `price: 0` обрабатывается как ошибка валидации
- Невозможно создать объявление с бесплатным товаром
- Нарушается бизнес-логика платформы, где могут быть бесплатные объявления

**Шаги воспроизведения:**
1. Отправить запрос на создание объявления с нулевой ценой:
```json
{
  "sellerID": 123456,
  "name": "Бесплатный товар",
  "price": 0,
  "statistics": {
    "likes": 10,
    "viewCount": 100,
    "contacts": 5
  }
}
```
Ожидаемый результат: Объявление успешно создается со статусом 200

Фактический результат: Возвращается ошибка 400

**Обоснование исправления:**

- Бесплатные объявления являются стандартной практикой на торговых площадках
- Цена 0 должна быть допустимым значением для обозначения бесплатного товара
- Если требуется минимальная цена, она должна быть явно указана в документации (например, 1 рубль)

**Рекомендация:**

- Разрешить значение price: 0 для бесплатных объявлений
- Либо явно документировать минимально допустимую цену и возвращать соответствующую ошибку
